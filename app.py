import streamlit as st
import openai
import os
from dotenv import load_dotenv

# ‘≤’•’º’∂’°’æ’∏÷Ä’∏÷Ç’¥ ’•’∂÷Ñ .env ÷Ü’°’µ’¨’´÷Å
load_dotenv()
openai.api_key = os.getenv("OPENAI_API_KEY")

st.set_page_config(page_title="AI Content Generator", page_icon="üìù", layout="centered")

st.title("üìù AI Content Generator")
st.write("’ç’ø’•’≤’Æ’´÷Ä ’¢’∏’æ’°’∂’§’°’Ø’∏÷Ç’©’µ’∏÷Ç’∂ ’°÷Ä’∞’•’Ω’ø’°’Ø’°’∂ ’¢’°’∂’°’Ø’°’∂’∏÷Ç’©’µ’°’¥’¢÷â")

# ’Ñ’∏÷Ç’ø÷Ñ’°’µ’´’∂ ’ø’•÷Ñ’Ω’ø
user_prompt = st.text_area("’Ñ’∏÷Ç’ø÷Ñ’°’£÷Ä’´÷Ä ’©’•’¥’°’∂ ’Ø’°’¥ ’°’º’°’ª’°÷Ä’Ø’®:")

# ‘∏’∂’ø÷Ä’°÷Å’°’∂’Ø’•÷Ä
content_type = st.selectbox(
    "‘∏’∂’ø÷Ä’´÷Ä ’¢’∏’æ’°’∂’§’°’Ø’∏÷Ç’©’µ’°’∂ ’ø’•’Ω’°’Ø’®",
    ["’Ä’∏’§’æ’°’Æ", "‘≤’¨’∏’£ ’£÷Ä’°’º’∏÷Ç’¥", "’ñ’•’µ’Ω’¢’∏÷Ç÷Ñ ’£÷Ä’°’º’∏÷Ç’¥", "’Ñ’°÷Ä÷Ñ’•’©’´’∂’£’°’µ’´’∂ ’Ω’¨’∏’£’°’∂", "’Ñ’°÷Ä’§’Ø’°’µ’´’∂ ’∏’≥’∏’æ ’¢’°÷Å’°’ø÷Ä’∏÷Ç’©’µ’∏÷Ç’∂"]
)

length = st.radio(
    "’è’•÷Ñ’Ω’ø’´ ’•÷Ä’Ø’°÷Ä’∏÷Ç’©’µ’∏÷Ç’∂’®",
    ["‘ø’°÷Ä’≥ (’¥’´’∂’π÷á 100 ’¢’°’º)", "’Ñ’´’ª’´’∂ (100-300 ’¢’°’º)", "‘µ÷Ä’Ø’°÷Ä (300+ ’¢’°’º)"]
)

language = st.selectbox(
    "‘º’•’¶’∏÷Ç’∂",
    ["’Ä’°’µ’•÷Ä’•’∂", "‘±’∂’£’¨’•÷Ä’•’∂", "’å’∏÷Ç’Ω’•÷Ä’•’∂"]
)

# ’ç’ø’•’≤’Æ’•’¨’∏÷Ç ’Ø’∏’≥’°’Ø
if st.button("’ç’ø’•’≤’Æ’•’¨ ’¢’∏’æ’°’∂’§’°’Ø’∏÷Ç’©’µ’∏÷Ç’∂"):
    if user_prompt:
        try:
            # Prompt ’±÷á’°’æ’∏÷Ä’∏÷Ç’¥
            length_instruction = {
                "‘ø’°÷Ä’≥ (’¥’´’∂’π÷á 100 ’¢’°’º)": "‘ø’°÷Ä’≥ ’ø’•÷Ñ’Ω’ø, ’¥’´’∂’π÷á 100 ’¢’°’º",
                "’Ñ’´’ª’´’∂ (100-300 ’¢’°’º)": "’Ñ’´’ª’´’∂ ’•÷Ä’Ø’°÷Ä’∏÷Ç’©’µ’°’∂ ’ø’•÷Ñ’Ω’ø, ’¥’∏’ø 200 ’¢’°’º",
                "‘µ÷Ä’Ø’°÷Ä (300+ ’¢’°’º)": "‘µ÷Ä’Ø’°÷Ä ’ø’•÷Ñ’Ω’ø, ’°’æ’•’¨’´ ÷Ñ’°’∂ 300 ’¢’°’º"
            }

            full_prompt = f"""
            ’ç’ø’•’≤’Æ’´÷Ä {content_type} {language} ’¨’•’¶’æ’∏’æ:
            ‘π’•’¥’°: {user_prompt}
            ’è’•÷Ñ’Ω’ø’´ ’•÷Ä’Ø’°÷Ä’∏÷Ç’©’µ’∏÷Ç’∂’ù {length_instruction[length]}÷â
            """

            # ‘ø’°’∂’π’∏÷Ç’¥ ’•’∂÷Ñ ’¥’∏’§’•’¨’´’∂
            response = openai.chat.completions.create(
                model="gpt-4o-mini",
                messages=[
                    {"role": "system", "content": "‘¥’∏÷Ç ÷Ö’£’∂’∏÷Ç’¥ ’•’Ω ’£÷Ä’•’¨ ’¢’∏’æ’°’∂’§’°’Ø’∏÷Ç’©’µ’∏÷Ç’∂ ’∫’°÷Ä’¶ ÷á ÷Ö’£’ø’°’Ø’°÷Ä ’∏’≥’∏’æ÷â"},
                    {"role": "user", "content": full_prompt}
                ],
                max_tokens=600
            )

            ai_text = response.choices[0].message.content

            st.subheader("üìå ‘±÷Ä’§’µ’∏÷Ç’∂÷Ñ")
            st.write(ai_text)

            # ’ä’°’ø’≥’•’∂’•’¨’∏÷Ç ’Ø’∏’≥’°’Ø
            st.download_button("‚¨áÔ∏è ’ä’°’∞’•’¨ ’∏÷Ä’∫’•’Ω TXT", ai_text, file_name="content.txt")

        except Exception as e:
            st.error(f"’ç’≠’°’¨: {e}")
    else:
        st.warning("‘Ω’∂’§÷Ä’∏÷Ç’¥ ’•’∂÷Ñ ’¥’∏÷Ç’ø÷Ñ’°’£÷Ä’•’¨ ’©’•’¥’°÷â")
